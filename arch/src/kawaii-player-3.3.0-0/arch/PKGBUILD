pkgname=kawaii-player
_pkgname=kawaii-player
pkgver=3.1.1
pkgrel=0
pkgdesc="An Audio/Video Manager and Front End for mpv/mplayer along with functionalities of portable media server"
arch=(any)
conflicts=('kawaii-player-git')
license=('GPL3')
depends=('python' 'qt5-webengine' 'python-pyqt5' 'python-pycurl' 'curl' 'libnotify' 'python-dbus' 'libtorrent-rasterbar' 'python-mutagen'
        'python-beautifulsoup4' 'python-pillow' 'python-lxml' 'mpv' 'mplayer' 'ffmpegthumbnailer' 'sqlite3' 'python-pytaglib' 
	 'youtube-dl' 'wget')

makedepends=('git')

source=("https://github.com/kanishka-linux/${_pkgname}/releases/download/v${pkgver}-${pkgrel}/${_pkgname}-${pkgver}-${pkgrel}.tar.bz2")
md5sums=('SKIP')
_gitname=kawaii_player


package() {

  _bpath="${srcdir}/${_pkgname}-${pkgver}-${pkgrel}/${_gitname}"

  install -d "${pkgdir}/usr/share/${_pkgname}/"
  install -d "${pkgdir}/usr/share/applications/"
  install -d "${pkgdir}/usr/bin/"
  
  for file in "${_bpath}/"*;do
  	nm=$(echo $file | rev | cut -d'/' -f1 | rev)
  	if [ -d "$file" ];then
		install -d "${pkgdir}/usr/share/${_pkgname}/${nm}/"
		_plugin_path="$file/"
		for plugins in "${_plugin_path}"*;do
			plugin_name=$(echo $plugins | rev | cut -d'/' -f1 | rev)
            if [ $plugin_name == 'kawaii-player.desktop' ]; then
                echo $plugins
                echo 'desktop file copying'
                cat "${_plugin_path}kawaii-player.desktop" | sed 's/Exec=/Exec=python -B \/usr\/share\/kawaii-player\/kawaii_player.py \%f/g' > "${pkgdir}/usr/share/applications/kawaii-player.desktop"
			elif [ $plugin_name != 'installPlugins.py' ];then
				echo $plugins
				echo 'Plugins copying'
				install -Dm755 "$plugins" "${pkgdir}/usr/share/${_pkgname}/${nm}/"
			fi
		done
  	else
		if [ $nm == 'kawaii-player' ];then
			echo $file
			echo 'kawaii-player script'
			install -Dm755 "$file" "${pkgdir}/usr/bin/kawaii-player"
			chmod +x "${pkgdir}/usr/bin/kawaii-player"
		else 
            echo $file
            echo 'source files copying'
            install -Dm755 "$file" "${pkgdir}/usr/share/${_pkgname}/"
		fi
	fi
  done
  
}
